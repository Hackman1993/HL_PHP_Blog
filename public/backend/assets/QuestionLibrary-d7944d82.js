import{r as _,I as j,e as m,f,c as l,m as d,j as o,x as k,L as Q,t as z,q as S,B as h,k as E,n as L,u as B,a as N,h as V,A as D,F as R,C,M}from"./index-b3aac28e.js";import{M as F,i as O,T as G}from"./array-f3d36b88.js";import{A as H,a as P,b as J,c as W}from"./question-07f2bd4a.js";import{_ as X}from"./TinymceEditor-c6aeda3e.js";import{a as Y,b as Z}from"./index-eda7b12e.js";import{I as T,B as U,F as ee,a as I}from"./index-59a216ae.js";import{S as te}from"./index-8d11c964.js";import{S as oe}from"./StopOutlined-26b138b5.js";import{_ as ae}from"./_plugin-vue_export-helper-c27b6911.js";import"./_getTag-85b9c924.js";import"./index-fea68338.js";import"./zoom-90c40b94.js";import"./createContext-3fd9cd1c.js";import"./Col-f6a62d01.js";import"./TextArea-e3a590bb.js";import"./collapseMotion-ce991658.js";import"./LeftOutlined-25ee0845.js";import"./index-cd6781ee.js";import"./Compact-d4023c59.js";import"./request-737d36eb.js";import"./axios-05d0700c.js";import"./global-3a3875a2.js";const le={style:{display:"flex","align-items":"center","column-gap":"10px"}},ne={style:{margin:"0"}},se={__name:"SelectOptionEditor",props:["value"],emits:["update:value"],setup(w,{emit:c}){const p=w,n=_([]),u=_([]);j(()=>{if(p.value){let i=p.value;n.value=i.options,u.value=i.answer}else n.value=[],u.value=[]});const t=()=>{c("update:value",{options:n.value,answer:u.value})};return(i,v)=>(m(),f("div",null,[l(o(Z),{value:u.value,"onUpdate:value":v[0]||(v[0]=y=>u.value=y),style:{"flex-direction":"column","min-width":"100%"},onChange:t},{default:d(()=>[l(o(te),{direction:"vertical",style:{width:"100%"}},{default:d(()=>[(m(!0),f(k,null,Q(n.value,(y,g)=>(m(),f("div",le,[l(o(Y),{value:y.value=g,style:{"align-items":"center"},onChange:t},{default:d(()=>[z("正确答案")]),_:2},1032,["value"]),S("p",ne,h(String.fromCharCode(65+g))+".",1),l(o(T),{style:{"flex-grow":"1"},value:y.text,"onUpdate:value":x=>y.text=x,onChange:t},null,8,["value","onUpdate:value"]),l(o(U),{type:"primary",danger:"",shape:"circle",size:"small",icon:E(o(oe)),onClick:()=>{n.value=n.value.filter((x,r)=>g!==r),t()}},null,8,["icon","onClick"])]))),256))]),_:1})]),_:1},8,["value"]),l(o(U),{onClick:v[1]||(v[1]=()=>{n.value.push({text:""}),t()}),style:L([{width:"100%"},{marginTop:n.value.length?"10px":0}])},{default:d(()=>[z("+")]),_:1},8,["style"])]))}},ie={__name:"QuestionEditForm",props:["afterClose"],setup(w,{expose:c}){const p=w,{t:n}=B(),u=_({}),t=_({}),i=_(!1);_(null),c({show:(r={})=>{i.value=!0,t.value=r},close:()=>{i.value=!1}});const g=()=>{u.value.validate().then(()=>{Object.keys(t.value).forEach((r,e)=>{(t.value[r]===void 0||t.value[r]===null||t.value[r]==="")&&delete t.value[r]}),Object.hasOwn(t.value,"question_id")?P(t.value).then((r,e)=>{i.value=!1,p.afterClose&&p.afterClose()}):H(t.value).then((r,e)=>{i.value=!1,p.afterClose&&p.afterClose()})})},x=N(()=>{var r;return(r=t.value)!=null&&r.question_id?n("question.update"):n("question.create")});return(r,e)=>(m(),V(o(F),{open:i.value,"onUpdate:open":e[6]||(e[6]=a=>i.value=a),title:x.value,modal:"",style:{width:"80vw"},okText:o(n)("common.confirm"),cancelText:o(n)("common.cancel"),onOk:g,"mask-closable":!1,afterClose:null,keyboard:!1},{default:d(()=>[l(o(ee),{model:t.value,layout:"vertical",ref_key:"form",ref:u},{default:d(()=>[l(o(I),{name:"question_id",hidden:!0},{default:d(()=>[l(o(T),{value:t.value.question_id,"onUpdate:value":e[0]||(e[0]=a=>t.value.question_id=a)},null,8,["value"])]),_:1}),l(o(I),{label:o(n)("question.html"),name:"question_html",rules:[{required:!0,message:o(n)("question.question_required")}]},{default:d(()=>[l(X,{abstract:t.value.question_text,"onUpdate:abstract":e[1]||(e[1]=a=>t.value.question_text=a),value:t.value.question_html,"onUpdate:value":e[2]||(e[2]=a=>t.value.question_html=a),attachments:t.value.attachments,"onUpdate:attachments":e[3]||(e[3]=a=>t.value.attachments=a)},null,8,["abstract","value","attachments"])]),_:1},8,["label","rules"]),l(o(I),{name:"solution",label:o(n)("question.solution"),rules:[{required:!0,message:o(n)("question.solution_required")}]},{default:d(()=>[l(o(T),{value:t.value.solution,"onUpdate:value":e[4]||(e[4]=a=>t.value.solution=a)},null,8,["value"])]),_:1},8,["label","rules"]),l(o(I),{label:o(n)("question.option"),name:"option_data",rules:[{required:!0,message:o(n)("question.option_required")}]},{default:d(()=>[l(se,{value:t.value.option_data,"onUpdate:value":e[5]||(e[5]=a=>t.value.option_data=a)},null,8,["value"])]),_:1},8,["label","rules"])]),_:1},8,["model"])]),_:1},8,["open","title","okText","cancelText"]))}};const ue={style:{display:"flex"}},re={style:{"flex-grow":"1",display:"flex","align-items":"center"}},de={style:{"font-size":"20px","font-weight":"bold"}},ce={key:0},pe={key:1},me={__name:"QuestionLibrary",setup(w){const{t:c}=B(),p=_(),n=_([{title:c("question.text"),dataIndex:"question_text",resizable:!0,width:400},{title:c("question.option"),dataIndex:"option_data",ellipsis:!0,resizable:!0,width:150},{title:c("question.solution"),dataIndex:"solution",resizable:!0,width:150},{title:c("common.action"),dataIndex:"action",width:100}]),u=_({hideOnSinglePage:!0,current:1,total:1,pageSize:10,position:["bottomCenter"]}),t=_([]),i=D({selectedRowKeys:[],loading:!1}),v=()=>{J({page:u.value.current,limit:u.value.pageSize}).then(e=>{var a;if(u.value.total=e.data.total,u.value.current=e.data.current_page,Array.isArray((a=e==null?void 0:e.data)==null?void 0:a.data)){let s=[];e.data.data.forEach(q=>{q.key=q.question_id,s.push(q.key)}),i.selectedRowKeys=O(i.selectedRowKeys,s),t.value=e.data.data}})};v();const y=e=>{u.value.current=e.current,u.value.pageSize=e.pageSize,v()},g=e=>{F.confirm({title:c("common.delete_confirm"),content:c("question.delete_branch_confirmation",{count:e.length}),okText:c("common.confirm"),cancelText:c("common.cancel"),onOk(){W({ids:e}).then(()=>{v()})}})};function x(e,a){a.width=e}const r=e=>{i.selectedRowKeys=e};return(e,a)=>(m(),f(k,null,[l(o(G),{columns:n.value,"data-source":t.value,pagination:u.value,"row-selection":{selectedRowKeys:i.selectedRowKeys,onChange:r},onChange:y,onResizeColumn:x},{title:d(()=>[S("div",ue,[S("div",re,[S("div",de,h(o(c)("question.management")),1)]),l(o(U),{type:"primary",onClick:a[0]||(a[0]=s=>p.value.show())},{default:d(()=>[z(h(o(c)("question.create")),1)]),_:1})])]),footer:d(()=>[l(o(U),{type:"primary",danger:"",onClick:a[1]||(a[1]=s=>g(i.selectedRowKeys)),disabled:i.selectedRowKeys.length===0},{default:d(()=>[l(o(R),{icon:"fa-solid fa-trash"})]),_:1},8,["disabled"])]),bodyCell:d(s=>{var q,A,$,K;return[s.column.dataIndex==="question_text"?(m(),f("span",ce,h(s.record.question_text),1)):C("",!0),s.column.dataIndex==="action"?(m(),f("div",pe,[l(o(R),{class:"action-icon",icon:"fa-solid fa-pen-to-square",style:{color:"darkgreen"},onClick:b=>p.value.show(s.record)},null,8,["onClick"]),l(o(R),{class:"action-icon",icon:"fa-solid fa-trash",style:{color:"red"},onClick:b=>g([s.record.question_id])},null,8,["onClick"])])):C("",!0),s.column.dataIndex==="option_data"?(m(),f(k,{key:2},[(A=(q=s==null?void 0:s.record)==null?void 0:q.option_data)!=null&&A.options?(m(!0),f(k,{key:0},Q(s.record.option_data.options,b=>(m(),f("span",{class:M(["option",o(O)(s.record.option_data.answer,[b.value]).length?"option-right":"option-wrong"])},h(String.fromCharCode(65+b.value))+"."+h(b.text),3))),256)):C("",!0)],64)):C("",!0),s.column.dataIndex==="category"?(m(),f(k,{key:3},[z(h((K=($=s.record)==null?void 0:$.category)==null?void 0:K.label),1)],64)):C("",!0)]}),_:1},8,["columns","data-source","pagination","row-selection"]),l(ie,{ref_key:"dialog",ref:p,"after-close":v},null,512)],64))}},Qe=ae(me,[["__scopeId","data-v-068e7d0b"]]);export{Qe as default};
