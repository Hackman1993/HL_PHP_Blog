import{w as _,d as M,H as O,r as S,I as E,o as x,b as L,J as U,K as z,k as w,D as F,e as R,h as K,j as A,L as T}from"./index-21df96f3.js";import{r as H}from"./request-a2427700.js";import{F as N}from"./index-dd0be179.js";var q=["onActivate","onAddUndo","onBeforeAddUndo","onBeforeExecCommand","onBeforeGetContent","onBeforeRenderUI","onBeforeSetContent","onBeforePaste","onBlur","onChange","onClearUndos","onClick","onContextMenu","onCopy","onCut","onDblclick","onDeactivate","onDirty","onDrag","onDragDrop","onDragEnd","onDragGesture","onDragOver","onDrop","onExecCommand","onFocus","onFocusIn","onFocusOut","onGetContent","onHide","onInit","onKeyDown","onKeyPress","onKeyUp","onLoadContent","onMouseDown","onMouseEnter","onMouseLeave","onMouseMove","onMouseOut","onMouseOver","onMouseUp","onNodeChange","onObjectResizeStart","onObjectResized","onObjectSelected","onPaste","onPostProcess","onPostRender","onPreProcess","onProgressState","onRedo","onRemove","onReset","onSaveContent","onSelectionChange","onSetAttrib","onSetContent","onShow","onSubmit","onUndo","onVisualAid"],G=function(e){return q.map(function(t){return t.toLowerCase()}).indexOf(e.toLowerCase())!==-1},J=function(e,t,n){Object.keys(t).filter(G).forEach(function(a){var r=t[a];typeof r=="function"&&(a==="onInit"?r(e,n):n.on(a.substring(2),function(u){return r(u,n)}))})},W=function(e,t,n,a){var r=e.modelEvents?e.modelEvents:null,u=Array.isArray(r)?r.join(" "):r;_(a,function(l,i){n&&typeof l=="string"&&l!==i&&l!==n.getContent({format:e.outputFormat})&&n.setContent(l)}),n.on(u||"change input undo redo",function(){t.emit("update:modelValue",n.getContent({format:e.outputFormat}))})},Q=function(e,t,n,a,r,u){a.setContent(u()),n.attrs["onUpdate:modelValue"]&&W(t,n,a,r),J(e,n.attrs,a)},D=0,I=function(e){var t=Date.now(),n=Math.floor(Math.random()*1e9);return D++,e+"_"+n+D+String(t)},X=function(e){return e!==null&&e.tagName.toLowerCase()==="textarea"},j=function(e){return typeof e>"u"||e===""?[]:Array.isArray(e)?e:e.split(" ")},Y=function(e,t){return j(e).concat(j(t))},Z=function(e){return e==null},k=function(){return{listeners:[],scriptId:I("tiny-script"),scriptLoaded:!1}},$=function(){var e=k(),t=function(r,u,l,i){var o=u.createElement("script");o.referrerPolicy="origin",o.type="application/javascript",o.id=r,o.src=l;var m=function(){o.removeEventListener("load",m),i()};o.addEventListener("load",m),u.head&&u.head.appendChild(o)},n=function(r,u,l){e.scriptLoaded?l():(e.listeners.push(l),r.getElementById(e.scriptId)||t(e.scriptId,r,u,function(){e.listeners.forEach(function(i){return i()}),e.scriptLoaded=!0}))},a=function(){e=k()};return{load:n,reinitialize:a}},ee=$(),ne=function(){return typeof window<"u"?window:global},y=function(){var e=ne();return e&&e.tinymce?e.tinymce:null},te={apiKey:String,cloudChannel:String,id:String,init:Object,initialValue:String,inline:Boolean,modelEvents:[String,Array],plugins:[String,Array],tagName:String,toolbar:[String,Array],modelValue:String,disabled:Boolean,tinymceScriptSrc:String,outputFormat:{type:String,validator:function(e){return e==="html"||e==="text"}}},p=globalThis&&globalThis.__assign||function(){return p=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++){t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},p.apply(this,arguments)},ae=function(e,t,n,a){return e(a||"div",{id:t,ref:n})},oe=function(e,t,n){return e("textarea",{id:t,visibility:"hidden",ref:n})},re=M({props:te,setup:function(e,t){var n=e.init?p({},e.init):{},a=O(e),r=a.disabled,u=a.modelValue,l=a.tagName,i=S(null),o=null,m=e.id||I("tiny-vue"),g=e.init&&e.init.inline||e.inline,f=!!t.attrs["onUpdate:modelValue"],d=!0,v=e.initialValue?e.initialValue:"",h="",V=function(c){return f?function(){return u!=null&&u.value?u.value:""}:function(){return c?v:h}},C=function(){var c=V(d),s=p(p({},n),{readonly:e.disabled,target:i.value,plugins:Y(n.plugins,e.plugins),toolbar:e.toolbar||n.toolbar,inline:g,setup:function(b){o=b,b.on("init",function(B){return Q(B,e,t,b,u,c)}),typeof n.setup=="function"&&n.setup(b)}});X(i.value)&&(i.value.style.visibility=""),y().init(s),d=!1};_(r,function(c){var s;o!==null&&(typeof((s=o.mode)===null||s===void 0?void 0:s.set)=="function"?o.mode.set(c?"readonly":"design"):o.setMode(c?"readonly":"design"))}),_(l,function(c){var s;f||(h=o.getContent()),(s=y())===null||s===void 0||s.remove(o),E(function(){return C()})}),x(function(){if(y()!==null)C();else if(i.value&&i.value.ownerDocument){var c=e.cloudChannel?e.cloudChannel:"6",s=e.apiKey?e.apiKey:"no-api-key",b=Z(e.tinymceScriptSrc)?"https://cdn.tiny.cloud/1/".concat(s,"/tinymce/").concat(c,"/tinymce.min.js"):e.tinymceScriptSrc;ee.load(i.value.ownerDocument,b,C)}}),L(function(){y()!==null&&y().remove(o)}),g||(U(function(){d||C()}),z(function(){var c;f||(h=o.getContent()),(c=y())===null||c===void 0||c.remove(o)}));var P=function(c){var s;h=o.getContent(),(s=y())===null||s===void 0||s.remove(o),n=p(p({},n),c),E(function(){return C()})};return t.expose({rerender:P,getEditor:function(){return o}}),function(){return g?ae(w,m,i,e.tagName):oe(w,m,i)}}});const ie=e=>H("/attachment/upload","post",e),se={__name:"TinymceEditor",props:["value","abstract","attachments"],emits:["update:value","update:abstract","update:attachments","change"],setup(e,{expose:t,emit:n}){const a=e,r=N.useInjectFormItemContext();let u=S(),l=S([]),i=S(a.value);t({value:i,editor_attachments:l});const o=(g,f)=>new Promise((d,v)=>{ie({file:g.blob()}).then(h=>{l.value.push(h.data.attachment_id),n("update:attachments",l.value),d(h.data.access_url)})});F(()=>{i.value=a.value?a.value:""});const m=(g,f)=>{let d=f.getContent(),v=f.getContent({format:"text"});v=v.replaceAll(`
`,""),v=v.substring(0,200),n("update:value",d),n("update:abstract",v),n("change",d),r.onFieldChange()};return(g,f)=>(R(),K(A(re),{ref_key:"editor",ref:u,modelValue:A(i),"onUpdate:modelValue":f[0]||(f[0]=d=>T(i)?i.value=d:i=d),"api-key":"bkfzcveiis7xhbstaqc76avuy8rps8zq2iff70838ko49514","model-events":"change keydown blur focus paste",onChange:m,init:{language:"zh-Hans",language_url:"/i18n/zh-Hans.js",menubar:!1,plugins:"advlist autolink lists link image charmap preview anchor searchreplace visualblocks code fullscreen insertdatetime media table code wordcount media link",toolbar:"formatselect | bold italic backcolor styles | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | removeformat | image media | link",automatic_uploads:!0,images_upload_handler:o}},null,8,["modelValue","init"]))}};export{se as _};
