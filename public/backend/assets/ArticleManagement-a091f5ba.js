import{w as K,d as W,A as ae,r as y,B as P,o as ne,b as oe,C as le,D as ie,k as L,E as D,e as C,h as A,j as v,G as re,u as M,v as J,m as b,f as U,x as O,H as ue,q as R,y as z,c as p,a as se,z as F,t as T,F as V}from"./index-1a1a41e3.js";import{A as ce,a as de,b as ve,c as fe,d as me,e as pe,f as ge}from"./article-b6154b7d.js";import{R as ye,C as _e,i as Q,S as X,M as Y,T as he}from"./array-afb2febe.js";import{r as be,F as B,a as E,I as G,B as N}from"./request-3404f2b5.js";import{A as Ce}from"./dictionary-77303096.js";import{_ as ke}from"./_plugin-vue_export-helper-c27b6911.js";import"./global-cdbf2ca7.js";import"./LeftOutlined-93c8ff1b.js";var we=["onActivate","onAddUndo","onBeforeAddUndo","onBeforeExecCommand","onBeforeGetContent","onBeforeRenderUI","onBeforeSetContent","onBeforePaste","onBlur","onChange","onClearUndos","onClick","onContextMenu","onCopy","onCut","onDblclick","onDeactivate","onDirty","onDrag","onDragDrop","onDragEnd","onDragGesture","onDragOver","onDrop","onExecCommand","onFocus","onFocusIn","onFocusOut","onGetContent","onHide","onInit","onKeyDown","onKeyPress","onKeyUp","onLoadContent","onMouseDown","onMouseEnter","onMouseLeave","onMouseMove","onMouseOut","onMouseOver","onMouseUp","onNodeChange","onObjectResizeStart","onObjectResized","onObjectSelected","onPaste","onPostProcess","onPostRender","onPreProcess","onProgressState","onRedo","onRemove","onReset","onSaveContent","onSelectionChange","onSetAttrib","onSetContent","onShow","onSubmit","onUndo","onVisualAid"],Se=function(e){return we.map(function(n){return n.toLowerCase()}).indexOf(e.toLowerCase())!==-1},xe=function(e,n,t){Object.keys(n).filter(Se).forEach(function(s){var i=n[s];typeof i=="function"&&(s==="onInit"?i(e,t):t.on(s.substring(2),function(a){return i(a,t)}))})},Ae=function(e,n,t,s){var i=e.modelEvents?e.modelEvents:null,a=Array.isArray(i)?i.join(" "):i;K(s,function(o,l){t&&typeof o=="string"&&o!==l&&o!==t.getContent({format:e.outputFormat})&&t.setContent(o)}),t.on(a||"change input undo redo",function(){n.emit("update:modelValue",t.getContent({format:e.outputFormat}))})},Ie=function(e,n,t,s,i,a){s.setContent(a()),t.attrs["onUpdate:modelValue"]&&Ae(n,t,s,i),xe(e,t.attrs,s)},$=0,Z=function(e){var n=Date.now(),t=Math.floor(Math.random()*1e9);return $++,e+"_"+t+$+String(n)},Ee=function(e){return e!==null&&e.tagName.toLowerCase()==="textarea"},q=function(e){return typeof e>"u"||e===""?[]:Array.isArray(e)?e:e.split(" ")},Ue=function(e,n){return q(e).concat(q(n))},De=function(e){return e==null},H=function(){return{listeners:[],scriptId:Z("tiny-script"),scriptLoaded:!1}},Re=function(){var e=H(),n=function(i,a,o,l){var d=a.createElement("script");d.referrerPolicy="origin",d.type="application/javascript",d.id=i,d.src=o;var g=function(){d.removeEventListener("load",g),l()};d.addEventListener("load",g),a.head&&a.head.appendChild(d)},t=function(i,a,o){e.scriptLoaded?o():(e.listeners.push(o),i.getElementById(e.scriptId)||n(e.scriptId,i,a,function(){e.listeners.forEach(function(l){return l()}),e.scriptLoaded=!0}))},s=function(){e=H()};return{load:t,reinitialize:s}},ze=Re(),Be=function(){return typeof window<"u"?window:global},S=function(){var e=Be();return e&&e.tinymce?e.tinymce:null},je={apiKey:String,cloudChannel:String,id:String,init:Object,initialValue:String,inline:Boolean,modelEvents:[String,Array],plugins:[String,Array],tagName:String,toolbar:[String,Array],modelValue:String,disabled:Boolean,tinymceScriptSrc:String,outputFormat:{type:String,validator:function(e){return e==="html"||e==="text"}}},x=globalThis&&globalThis.__assign||function(){return x=Object.assign||function(e){for(var n,t=1,s=arguments.length;t<s;t++){n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},x.apply(this,arguments)},Ve=function(e,n,t,s){return e(s||"div",{id:n,ref:t})},Ke=function(e,n,t){return e("textarea",{id:n,visibility:"hidden",ref:t})},Oe=W({props:je,setup:function(e,n){var t=e.init?x({},e.init):{},s=ae(e),i=s.disabled,a=s.modelValue,o=s.tagName,l=y(null),d=null,g=e.id||Z("tiny-vue"),m=e.init&&e.init.inline||e.inline,f=!!n.attrs["onUpdate:modelValue"],r=!0,u=e.initialValue?e.initialValue:"",c="",k=function(_){return f?function(){return a!=null&&a.value?a.value:""}:function(){return _?u:c}},w=function(){var _=k(r),h=x(x({},t),{readonly:e.disabled,target:l.value,plugins:Ue(t.plugins,e.plugins),toolbar:e.toolbar||t.toolbar,inline:m,setup:function(I){d=I,I.on("init",function(te){return Ie(te,e,n,I,a,_)}),typeof t.setup=="function"&&t.setup(I)}});Ee(l.value)&&(l.value.style.visibility=""),S().init(h),r=!1};K(i,function(_){var h;d!==null&&(typeof((h=d.mode)===null||h===void 0?void 0:h.set)=="function"?d.mode.set(_?"readonly":"design"):d.setMode(_?"readonly":"design"))}),K(o,function(_){var h;f||(c=d.getContent()),(h=S())===null||h===void 0||h.remove(d),P(function(){return w()})}),ne(function(){if(S()!==null)w();else if(l.value&&l.value.ownerDocument){var _=e.cloudChannel?e.cloudChannel:"6",h=e.apiKey?e.apiKey:"no-api-key",I=De(e.tinymceScriptSrc)?"https://cdn.tiny.cloud/1/".concat(h,"/tinymce/").concat(_,"/tinymce.min.js"):e.tinymceScriptSrc;ze.load(l.value.ownerDocument,I,w)}}),oe(function(){S()!==null&&S().remove(d)}),m||(le(function(){r||w()}),ie(function(){var _;f||(c=d.getContent()),(_=S())===null||_===void 0||_.remove(d)}));var j=function(_){var h;c=d.getContent(),(h=S())===null||h===void 0||h.remove(d),t=x(x({},t),_),P(function(){return w()})};return n.expose({rerender:j,getEditor:function(){return d}}),function(){return m?Ve(L,g,l,e.tagName):Ke(L,g,l)}}});const Fe=e=>be("/attachment/upload","post",e);function Me(e){return"/backend"+e}const Pe={__name:"TinymceEditor",props:["value","abstract","attachments"],emits:["update:value","update:abstract","update:attachments","change"],setup(e,{expose:n,emit:t}){const s=e,i=B.useInjectFormItemContext();let a=y(),o=y([]),l=y(s.value);n({value:l,editor_attachments:o});const d=(m,f)=>new Promise((r,u)=>{Fe({file:m.blob()}).then(c=>{o.value.push(c.data.attachment_id),t("update:attachments",o.value),r(c.data.access_url)})});D(()=>{l.value=s.value?s.value:""});const g=(m,f)=>{let r=f.getContent(),u=f.getContent({format:"text"});u=u.replaceAll(`
`,""),u=u.substring(0,200),t("update:value",r),t("update:abstract",u),t("change",r),i.onFieldChange()};return(m,f)=>(C(),A(v(Oe),{ref_key:"editor",ref:a,modelValue:v(l),"onUpdate:modelValue":f[0]||(f[0]=r=>re(l)?l.value=r:l=r),"api-key":"bkfzcveiis7xhbstaqc76avuy8rps8zq2iff70838ko49514","model-events":"change keydown blur focus paste",onChange:g,init:{language:"zh-Hans",language_url:v(Me)("/i18n/zh-Hans.js"),menubar:!1,plugins:"advlist autolink lists link image charmap preview anchor searchreplace visualblocks code fullscreen insertdatetime media table code wordcount media link",toolbar:"formatselect | bold italic backcolor styles | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | removeformat | image media | link",automatic_uploads:!0,images_upload_handler:d}},null,8,["modelValue","init"]))}},Le={__name:"DictionaryItemSelector",props:{value:{required:!0,type:Array,default:[]},dictKey:{required:!0,type:String},single:{type:Boolean,default:!1},buttonType:{type:Boolean,default:!0}},emits:["update:value","change"],setup(e,{emit:n}){const t=e,{t:s}=M(),i=y([]);let a=[];const o=J({value:t.value??[]}),l=g=>{let m=[];Array.isArray(o.value)?m=o.value:m=[o.value],minus(a,m),n("update:value",m),n("change")};let d=null;return D(()=>{t.dictKey!=d&&Ce({dict_key:t.dictKey}).then(g=>{let m=[];g.data.items.forEach(f=>{f.label=f.translate?s(f.text):f.text,f.value=f.dict_item_id,f.onChange=l,m.push(f.value)}),a=m,i.value=g.data.items,d=t.dictKey}),t.single?o.value=Array.isArray(t.value)?t.value[0]:t.value:o.value=t.value}),(g,m)=>t.single?(C(),A(v(ye),{key:0,value:o.value,"onUpdate:value":m[0]||(m[0]=f=>o.value=f),options:i.value,onChange:l,"option-type":t.buttonType?"button":"default"},null,8,["value","options","option-type"])):(C(),A(v(_e).Group,{key:1,value:o.value,"onUpdate:value":m[1]||(m[1]=f=>o.value=f),options:i.value,onChange:l},null,8,["value","options"]))}},Te={style:{width:"100%",display:"flex","column-gap":"10px","margin-top":"10px"}},ee={__name:"DictionaryGroupFormItem",props:["value","options"],emits:["update:value","change"],setup(e,{emit:n}){const t=e,s=y(t.options??[]);y(t.value??[]);const i=y([]),a=()=>{n("update:value",[].concat(...i.value))};return D(()=>{s.value=t.options??[];let o=[];for(let l=0;l<s.value.length;l++)o[l]=Q(s.value[l].items.map(d=>d.dict_item_id),t.value??[]);i.value=o}),(o,l)=>(C(),A(v(B).ItemRest,null,{default:b(()=>[(C(!0),U(O,null,ue(s.value,(d,g)=>(C(),U("div",Te,[R("span",null,z(d.text)+" : ",1),p(Le,{"dict-key":d.dict_key,value:i.value[g],"onUpdate:value":m=>i.value[g]=m,onChange:a},null,8,["dict-key","value","onUpdate:value"])]))),256))]),_:1}))}};const Ge={__name:"CategorySelector",props:["value","placeholder","except"],emits:["update:value","change"],setup(e,{emit:n}){const t=e,s=y([]),i=y(t.value);D(()=>{i.value=t.value}),ce().then(o=>{o.data.forEach(l=>{l.value=l.art_category_id}),s.value=o.data});const a=o=>{n("update:value",o),n("change",o)};return(o,l)=>(C(),A(v(B).ItemRest,null,{default:b(()=>[p(v(X),{value:i.value,"onUpdate:value":l[0]||(l[0]=d=>i.value=d),options:s.value,"show-search":"",onChange:a},null,8,["value","options"]),p(ee)]),_:1}))}},Ne=ke(Ge,[["__scopeId","data-v-a83c63ad"]]);const $e={__name:"ArticleEditForm",props:["afterClose"],setup(e,{expose:n}){const t=e,{t:s}=M(),i=y({}),a=y({}),o=y(!1),l=y([]);n({show:(r={})=>{r.article_id?de({article_id:r.article_id}).then(u=>{var c,k;a.value=u.data,a.value.content=u.data.content_html,a.value.keywords=(k=(c=u.data)==null?void 0:c.keywords)==null?void 0:k.split(","),o.value=!0}):(o.value=!0,a.value=r)},close:()=>{o.value=!1}});const m=()=>{i.value.validate().then(()=>{Object.keys(a.value).forEach((r,u)=>{(a.value[r]===void 0||a.value[r]===null)&&delete a.value[r]}),Object.hasOwn(a.value,"article_id")?ve(a.value).then((r,u)=>{o.value=!1,t.afterClose&&t.afterClose()}):fe(a.value).then((r,u)=>{o.value=!1,t.afterClose&&t.afterClose()})})};D(()=>{a.value.fn_category_id?me({category_id:a.value.fn_category_id}).then(r=>{l.value=r.data.dictionaries}):l.value=[]});const f=se(()=>{var r;return(r=a.value)!=null&&r.article_id?s("article.update"):s("article.create")});return(r,u)=>(C(),A(v(Y),{open:o.value,"onUpdate:open":u[9]||(u[9]=c=>o.value=c),title:f.value,modal:"",style:{width:"80vw"},onOk:m,"mask-closable":!1,keyboard:!1},{default:b(()=>[p(v(B),{model:a.value,layout:"vertical",ref_key:"form",ref:i},{default:b(()=>[p(v(E),{name:"username",hidden:!0},{default:b(()=>[p(v(G),{value:a.value.article_id,"onUpdate:value":u[0]||(u[0]=c=>a.value.article_id=c)},null,8,["value"])]),_:1}),p(v(E),{label:v(s)("article.title"),name:"title",rules:[{required:!0,message:"Please input your username!"}]},{default:b(()=>[p(v(G),{value:a.value.title,"onUpdate:value":u[1]||(u[1]=c=>a.value.title=c)},null,8,["value"])]),_:1},8,["label"]),p(v(E),{label:v(s)("article.category"),name:"fn_category_id"},{default:b(()=>[p(Ne,{value:a.value.fn_category_id,"onUpdate:value":u[2]||(u[2]=c=>a.value.fn_category_id=c)},null,8,["value"])]),_:1},8,["label"]),l.value.length>0?(C(),A(v(E),{key:0,label:v(s)("article.dict_data")},{default:b(()=>[p(ee,{value:a.value.dict_item_ids,"onUpdate:value":u[3]||(u[3]=c=>a.value.dict_item_ids=c),options:l.value,onChange:u[4]||(u[4]=c=>console.log(a.value))},null,8,["value","options"])]),_:1},8,["label"])):F("",!0),p(v(E),{label:v(s)("article.keywords"),name:"keywords"},{default:b(()=>[p(v(X),{value:a.value.keywords,"onUpdate:value":u[5]||(u[5]=c=>a.value.keywords=c),"token-separators":[","," "],mode:"tags"},null,8,["value"])]),_:1},8,["label"]),p(v(E),{label:v(s)("article.content"),name:"content"},{default:b(()=>[p(Pe,{abstract:a.value.abstract,"onUpdate:abstract":u[6]||(u[6]=c=>a.value.abstract=c),value:a.value.content,"onUpdate:value":u[7]||(u[7]=c=>a.value.content=c),attachments:a.value.attachments,"onUpdate:attachments":u[8]||(u[8]=c=>a.value.attachments=c)},null,8,["abstract","value","attachments"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["open","title"]))}},qe={style:{display:"flex"}},He={style:{"flex-grow":"1",display:"flex","align-items":"center"}},We={style:{"font-size":"20px","font-weight":"bold"}},Je={key:0},ot=W({__name:"ArticleManagement",setup(e){const{t:n}=M(),t=y(),s=y([{title:n("article.title"),dataIndex:"title",ellipsis:!0,resizable:!0,minWidth:100,width:200},{title:n("article.keywords"),dataIndex:"keywords",ellipsis:!0,resizable:!0,width:150,minWidth:150},{title:n("article.category"),dataIndex:"category",ellipsis:!0,resizable:!0,width:150,minWidth:150},{title:n("article.abstract"),dataIndex:"abstract",ellipsis:!0,resizable:!0,width:300,minWidth:150},{title:n("common.action"),dataIndex:"action",width:100,minWidth:100}]),i=y({hideOnSinglePage:!0,current:1,total:1,pageSize:10,position:["bottomCenter"]}),a=y([]),o=J({selectedRowKeys:[],loading:!1}),l=()=>{pe({page:i.value.current,limit:i.value.pageSize}).then(r=>{var u;if(i.value.total=r.data.total,i.value.current=r.data.current_page,Array.isArray((u=r==null?void 0:r.data)==null?void 0:u.data)){let c=[];r.data.data.forEach(k=>{k.key=k.article_id,c.push(k.key)}),o.selectedRowKeys=Q(o.selectedRowKeys,c),a.value=r.data.data}})};l();const d=r=>{i.value.current=r.current,i.value.pageSize=r.pageSize,l()},g=r=>{Y.confirm({title:n("common.delete_confirm"),content:n("article.delete_branch_confirmation",{count:r.length}),okText:n("common.confirm"),cancelText:n("common.cancel"),onOk(){ge({article_ids:r}).then(()=>{l()})}})};function m(r,u){u.width=r}const f=r=>{o.selectedRowKeys=r};return(r,u)=>(C(),U(O,null,[p(v(he),{columns:s.value,"data-source":a.value,pagination:i.value,"row-selection":{selectedRowKeys:o.selectedRowKeys,onChange:f},onChange:d,onResizeColumn:m},{title:b(()=>[R("div",qe,[R("div",He,[R("div",We,z(v(n)("article.management")),1)]),p(v(N),{type:"primary",onClick:u[0]||(u[0]=c=>t.value.show())},{default:b(()=>[T(z(v(n)("article.create")),1)]),_:1})])]),footer:b(()=>[p(v(N),{type:"primary",danger:"",onClick:u[1]||(u[1]=c=>g(o.selectedRowKeys)),disabled:o.selectedRowKeys.length===0},{default:b(()=>[p(v(V),{icon:"fa-solid fa-trash"})]),_:1},8,["disabled"])]),bodyCell:b(c=>{var k,w;return[c.column.dataIndex==="action"?(C(),U("div",Je,[p(v(V),{class:"action-icon",icon:"fa-solid fa-pen-to-square",style:{color:"darkgreen"},onClick:j=>t.value.show(c.record)},null,8,["onClick"]),p(v(V),{class:"action-icon",icon:"fa-solid fa-trash",style:{color:"red"},onClick:j=>g([c.record.article_id])},null,8,["onClick"])])):F("",!0),c.column.dataIndex==="category"?(C(),U(O,{key:1},[T(z((w=(k=c.record)==null?void 0:k.category)==null?void 0:w.label),1)],64)):F("",!0)]}),_:1},8,["columns","data-source","pagination","row-selection"]),p($e,{ref_key:"dialog",ref:t,"after-close":l},null,512)],64))}});export{ot as default};
