import{b as O,c as j,d as A,e as F}from"./dictionary-77303096.js";import{u as D,r as f,E as B,e as _,h as S,m as c,q as b,f as x,x as R,H as T,c as l,j as t,y as g,t as q,k as V,F as U,a as W,d as N,v as H,z as $}from"./index-1a1a41e3.js";import{C as L,M as E,T as M,i as P}from"./array-afb2febe.js";import{_ as G}from"./_plugin-vue_export-helper-c27b6911.js";import{I as C,B as z,F as K,a as I}from"./request-3404f2b5.js";import{S as J}from"./StopOutlined-40b24d55.js";import"./global-cdbf2ca7.js";import"./LeftOutlined-93c8ff1b.js";const Q={style:{display:"flex","flex-direction":"column","row-gap":"10px"}},X={class:"dictionary-item"},Y={__name:"DictionaryItemEditor",props:["value","deleted"],emits:["update:value","update:deleted"],setup(w,{emit:s}){const m=w;let{t:r}=D();const n=f(m.value??[]),a=()=>{s("update:value",n.value)};B(()=>{n.value=m.value??[]});let d=f([]);const k=h=>{var v;(v=n.value[h])!=null&&v.hasOwnProperty("dict_item_id")&&(d.value.push(n.value[h].dict_item_id),s("update:deleted",d.value)),n.value=n.value.filter((u,o)=>h!==o)};return(h,v)=>(_(),S(t(K).ItemRest,null,{default:c(()=>[b("div",Q,[(_(!0),x(R,null,T(n.value,(u,o)=>(_(),x("div",X,[l(t(C),{value:u.dict_item_id,"onUpdate:value":e=>u.dict_item_id=e,style:{display:"none"}},null,8,["value","onUpdate:value"]),b("span",null,g(t(r)("dictionary.key")),1),l(t(C),{value:u.item_key,"onUpdate:value":e=>u.item_key=e,onClick:a},null,8,["value","onUpdate:value"]),b("span",null,g(t(r)("dictionary.text")),1),l(t(C),{value:u.text,"onUpdate:value":e=>u.text=e,onClick:a},null,8,["value","onUpdate:value"]),l(t(L),{checked:u.translate,"onUpdate:checked":e=>u.translate=e,onClick:a},{default:c(()=>[q(g(t(r)("dictionary.translatable")),1)]),_:2},1032,["checked","onUpdate:checked"]),l(t(z),{type:"primary",style:{display:"flex","justify-content":"center","align-items":"center"},danger:"",shape:"circle",size:"small",icon:V(t(J)),onClick:e=>k(o)},null,8,["icon","onClick"])]))),256)),l(t(z),{style:{width:"100%"},onClick:v[0]||(v[0]=u=>n.value.push({text:"",translate:!1}))},{default:c(()=>[l(t(U),{icon:"fa-solid fa-add"})]),_:1})])]),_:1}))}},Z=G(Y,[["__scopeId","data-v-8986de57"]]),ee={__name:"DictionaryForm",props:["afterClose","value"],setup(w,{expose:s}){const m=w,{t:r}=D(),n=f({}),a=f({}),d=f(!1);s({show:(o={})=>{var e;d.value=!0,a.value=o,(e=n.value)!=null&&e.clearValidate&&n.value.clearValidate()},close:()=>{d.value=!1}});const v=()=>{n.value.validate().then(()=>{Object.keys(a.value).forEach((o,e)=>{(a.value[o]===void 0||a.value[o]===null||a.value[o]==="")&&delete a.value[o]}),Object.hasOwn(a.value,"dictionary_id")?j(a.value).then((o,e)=>{d.value=!1,m.afterClose&&m.afterClose()}):O(a.value).then((o,e)=>{d.value=!1,m.afterClose&&m.afterClose()})})},u=W(()=>{var o;return(o=a.value)!=null&&o.dictionary_id?r("dictionary.update"):r("dictionary.create")});return(o,e)=>(_(),S(t(E),{open:d.value,"onUpdate:open":e[5]||(e[5]=i=>d.value=i),title:u.value,modal:"",style:{width:"80vw"},okText:t(r)("common.confirm"),cancelText:t(r)("common.cancel"),onOk:v,"mask-closable":!1,afterClose:null,keyboard:!1},{default:c(()=>[l(t(K),{model:a.value,layout:"vertical",ref_key:"form",ref:n,name:"form"},{default:c(()=>[l(t(I),{name:"dictionary_id",hidden:!0},{default:c(()=>[l(t(C),{value:a.value.dictionary_id,"onUpdate:value":e[0]||(e[0]=i=>a.value.dictionary_id=i)},null,8,["value"])]),_:1}),l(t(I),{name:"text",label:t(r)("dictionary.name"),rules:[{required:!0,message:t(r)("dictionary.name_required")}]},{default:c(()=>[l(t(C),{value:a.value.text,"onUpdate:value":e[1]||(e[1]=i=>a.value.text=i)},null,8,["value"])]),_:1},8,["label","rules"]),l(t(I),{name:"dict_key",label:t(r)("dictionary.key"),rules:[{required:!0,message:t(r)("dictionary.key_required")}]},{default:c(()=>[l(t(C),{value:a.value.dict_key,"onUpdate:value":e[2]||(e[2]=i=>a.value.dict_key=i)},null,8,["value"])]),_:1},8,["label","rules"]),l(t(I),{name:"items",label:t(r)("dictionary.items"),rules:[{required:!0,message:t(r)("dictionary.items_required")}]},{default:c(()=>[l(Z,{value:a.value.items,"onUpdate:value":e[3]||(e[3]=i=>a.value.items=i),deleted:a.value.deleted,"onUpdate:deleted":e[4]||(e[4]=i=>a.value.deleted=i)},null,8,["value","deleted"])]),_:1},8,["label","rules"])]),_:1},8,["model"])]),_:1},8,["open","title","okText","cancelText"]))}},te={style:{display:"flex"}},ae={style:{"font-size":"20px","font-weight":"bold","flex-grow":"1"}},le={key:0},me=N({__name:"dictionary",setup(w){const{t:s}=D(),m=f(),r=f([{title:s("dictionary.id"),dataIndex:"dictionary_id",ellipsis:!0,resizable:!0,width:100,minWidth:100},{title:s("dictionary.key"),dataIndex:"dict_key",ellipsis:!0,resizable:!0,width:150,minWidth:150},{title:s("dictionary.text"),dataIndex:"text",ellipsis:!0,resizable:!0,width:150,minWidth:150},{title:s("dictionary.items"),dataIndex:"children",ellipsis:!0,resizable:!0,width:150,minWidth:150},{title:s("common.action"),dataIndex:"action",ellipsis:!0,resizable:!0,width:100,minWidth:100}]),n=f({hideOnSinglePage:!0,current:1,total:1,pageSize:10,position:["bottomCenter"]}),a=f([]),d=H({selectedRowKeys:[],loading:!1}),k=()=>{A({page:n.value.current,limit:n.value.pageSize}).then(e=>{var i;if(n.value.total=e.data.total,n.value.current=e.data.current_page,Array.isArray((i=e==null?void 0:e.data)==null?void 0:i.data)){let p=[];e.data.data.forEach(y=>{y.key=y.dictionary_id,p.push(y.key)}),d.selectedRowKeys=P(d.selectedRowKeys,p),a.value=e.data.data}})};k();const h=e=>{n.value.current=e.current,n.value.pageSize=e.pageSize,k()},v=e=>{E.confirm({title:s("common.delete_confirm"),content:s("dictionary.delete_branch_confirmation",{count:e.length}),okText:s("common.confirm"),cancelText:s("common.cancel"),onOk(){F({ids:e}).then(()=>{k()})}})};function u(e,i){i.width=e}const o=e=>{d.selectedRowKeys=e};return(e,i)=>(_(),x(R,null,[l(t(M),{columns:r.value,"data-source":a.value,pagination:n.value,"row-selection":{selectedRowKeys:d.selectedRowKeys,onChange:o},onChange:h,onResizeColumn:u},{title:c(()=>[b("div",te,[b("div",ae,g(t(s)("dictionary.management")),1),l(t(z),{type:"primary",onClick:i[0]||(i[0]=p=>m.value.show())},{default:c(()=>[q(g(t(s)("dictionary.create")),1)]),_:1})])]),footer:c(()=>[l(t(z),{type:"primary",danger:"",onClick:i[1]||(i[1]=p=>v(d.selectedRowKeys)),disabled:d.selectedRowKeys.length===0},{default:c(()=>[l(t(U),{icon:"fa-solid fa-trash"})]),_:1},8,["disabled"])]),bodyCell:c(p=>[p.column.dataIndex==="action"?(_(),x("div",le,[l(t(U),{class:"action-icon",icon:"fa-solid fa-pen-to-square",style:{color:"darkgreen"},onClick:y=>m.value.show(p.record)},null,8,["onClick"]),l(t(U),{class:"action-icon",icon:"fa-solid fa-trash",style:{color:"red"},onClick:y=>v([p.record.dictionary_id])},null,8,["onClick"])])):$("",!0),p.column.dataIndex==="children"?(_(!0),x(R,{key:1},T(p.record.items,y=>(_(),x("p",null,g(y.translate?t(s)(y.text):y.text),1))),256)):$("",!0)]),_:1},8,["columns","data-source","pagination","row-selection"]),l(ee,{ref_key:"dialog",ref:m,"after-close":k},null,512)],64))}});export{me as default};
