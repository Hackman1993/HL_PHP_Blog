import{b as K,c as O,d as j,e as B}from"./dictionary-1305017a.js";import{u as R,r as f,D as F,e as _,h as S,m as c,q as b,f as x,x as D,E as T,c as l,j as t,B as g,t as q,k as V,F as U,a as W,d as N,A as L,C as $}from"./index-21df96f3.js";import{M as A,T as M,i as P}from"./array-92a8b245.js";import{_ as H}from"./_plugin-vue_export-helper-c27b6911.js";import{I as C,B as z,F as E,a as I}from"./index-dd0be179.js";import{C as G}from"./index-a9aa29ea.js";import{S as J}from"./StopOutlined-011e502e.js";import"./request-a2427700.js";import"./axios-05d0700c.js";import"./global-d6a70a19.js";import"./_getTag-cb3a9032.js";import"./index-384f7243.js";import"./zoom-fa2480fe.js";import"./createContext-7f56f6d1.js";import"./Col-744c166f.js";import"./TextArea-070ff12e.js";import"./collapseMotion-551979cf.js";import"./LeftOutlined-5519a846.js";import"./index-5e00876c.js";import"./Compact-e6ea7b3c.js";const Q={style:{display:"flex","flex-direction":"column","row-gap":"10px"}},X={class:"dictionary-item"},Y={__name:"DictionaryItemEditor",props:["value","deleted"],emits:["update:value","update:deleted"],setup(w,{emit:r}){const m=w;let{t:s}=R();const i=f(m.value??[]),a=()=>{r("update:value",i.value)};F(()=>{i.value=m.value??[]});let d=f([]);const k=h=>{var p;(p=i.value[h])!=null&&p.hasOwnProperty("dict_item_id")&&(d.value.push(i.value[h].dict_item_id),r("update:deleted",d.value)),i.value=i.value.filter((u,n)=>h!==n)};return(h,p)=>(_(),S(t(E).ItemRest,null,{default:c(()=>[b("div",Q,[(_(!0),x(D,null,T(i.value,(u,n)=>(_(),x("div",X,[l(t(C),{value:u.dict_item_id,"onUpdate:value":e=>u.dict_item_id=e,style:{display:"none"}},null,8,["value","onUpdate:value"]),b("span",null,g(t(s)("dictionary.key")),1),l(t(C),{value:u.item_key,"onUpdate:value":e=>u.item_key=e,onClick:a},null,8,["value","onUpdate:value"]),b("span",null,g(t(s)("dictionary.text")),1),l(t(C),{value:u.text,"onUpdate:value":e=>u.text=e,onClick:a},null,8,["value","onUpdate:value"]),l(t(G),{checked:u.translate,"onUpdate:checked":e=>u.translate=e,onClick:a},{default:c(()=>[q(g(t(s)("dictionary.translatable")),1)]),_:2},1032,["checked","onUpdate:checked"]),l(t(z),{type:"primary",style:{display:"flex","justify-content":"center","align-items":"center"},danger:"",shape:"circle",size:"small",icon:V(t(J)),onClick:e=>k(n)},null,8,["icon","onClick"])]))),256)),l(t(z),{style:{width:"100%"},onClick:p[0]||(p[0]=u=>i.value.push({text:"",translate:!1}))},{default:c(()=>[l(t(U),{icon:"fa-solid fa-add"})]),_:1})])]),_:1}))}},Z=H(Y,[["__scopeId","data-v-8986de57"]]),ee={__name:"DictionaryForm",props:["afterClose","value"],setup(w,{expose:r}){const m=w,{t:s}=R(),i=f({}),a=f({}),d=f(!1);r({show:(n={})=>{var e;d.value=!0,a.value=n,(e=i.value)!=null&&e.clearValidate&&i.value.clearValidate()},close:()=>{d.value=!1}});const p=()=>{i.value.validate().then(()=>{Object.keys(a.value).forEach((n,e)=>{(a.value[n]===void 0||a.value[n]===null||a.value[n]==="")&&delete a.value[n]}),Object.hasOwn(a.value,"dictionary_id")?O(a.value).then((n,e)=>{d.value=!1,m.afterClose&&m.afterClose()}):K(a.value).then((n,e)=>{d.value=!1,m.afterClose&&m.afterClose()})})},u=W(()=>{var n;return(n=a.value)!=null&&n.dictionary_id?s("dictionary.update"):s("dictionary.create")});return(n,e)=>(_(),S(t(A),{open:d.value,"onUpdate:open":e[5]||(e[5]=o=>d.value=o),title:u.value,modal:"",style:{width:"80vw"},okText:t(s)("common.confirm"),cancelText:t(s)("common.cancel"),onOk:p,"mask-closable":!1,afterClose:null,keyboard:!1},{default:c(()=>[l(t(E),{model:a.value,layout:"vertical",ref_key:"form",ref:i,name:"form"},{default:c(()=>[l(t(I),{name:"dictionary_id",hidden:!0},{default:c(()=>[l(t(C),{value:a.value.dictionary_id,"onUpdate:value":e[0]||(e[0]=o=>a.value.dictionary_id=o)},null,8,["value"])]),_:1}),l(t(I),{name:"text",label:t(s)("dictionary.name"),rules:[{required:!0,message:t(s)("dictionary.name_required")}]},{default:c(()=>[l(t(C),{value:a.value.text,"onUpdate:value":e[1]||(e[1]=o=>a.value.text=o)},null,8,["value"])]),_:1},8,["label","rules"]),l(t(I),{name:"dict_key",label:t(s)("dictionary.key"),rules:[{required:!0,message:t(s)("dictionary.key_required")}]},{default:c(()=>[l(t(C),{value:a.value.dict_key,"onUpdate:value":e[2]||(e[2]=o=>a.value.dict_key=o)},null,8,["value"])]),_:1},8,["label","rules"]),l(t(I),{name:"items",label:t(s)("dictionary.items"),rules:[{required:!0,message:t(s)("dictionary.items_required")}]},{default:c(()=>[l(Z,{value:a.value.items,"onUpdate:value":e[3]||(e[3]=o=>a.value.items=o),deleted:a.value.deleted,"onUpdate:deleted":e[4]||(e[4]=o=>a.value.deleted=o)},null,8,["value","deleted"])]),_:1},8,["label","rules"])]),_:1},8,["model"])]),_:1},8,["open","title","okText","cancelText"]))}},te={style:{display:"flex"}},ae={style:{"font-size":"20px","font-weight":"bold","flex-grow":"1"}},le={key:0},we=N({__name:"dictionary",setup(w){const{t:r}=R(),m=f(),s=f([{title:r("dictionary.id"),dataIndex:"dictionary_id",ellipsis:!0,resizable:!0,width:100,minWidth:100},{title:r("dictionary.key"),dataIndex:"dict_key",ellipsis:!0,resizable:!0,width:150,minWidth:150},{title:r("dictionary.text"),dataIndex:"text",ellipsis:!0,resizable:!0,width:150,minWidth:150},{title:r("dictionary.items"),dataIndex:"children",ellipsis:!0,resizable:!0,width:150,minWidth:150},{title:r("common.action"),dataIndex:"action",ellipsis:!0,resizable:!0,width:100,minWidth:100}]),i=f({hideOnSinglePage:!0,current:1,total:1,pageSize:10,position:["bottomCenter"]}),a=f([]),d=L({selectedRowKeys:[],loading:!1}),k=()=>{j({page:i.value.current,limit:i.value.pageSize}).then(e=>{var o;if(i.value.total=e.data.total,i.value.current=e.data.current_page,Array.isArray((o=e==null?void 0:e.data)==null?void 0:o.data)){let v=[];e.data.data.forEach(y=>{y.key=y.dictionary_id,v.push(y.key)}),d.selectedRowKeys=P(d.selectedRowKeys,v),a.value=e.data.data}})};k();const h=e=>{i.value.current=e.current,i.value.pageSize=e.pageSize,k()},p=e=>{A.confirm({title:r("common.delete_confirm"),content:r("dictionary.delete_branch_confirmation",{count:e.length}),okText:r("common.confirm"),cancelText:r("common.cancel"),onOk(){B({ids:e}).then(()=>{k()})}})};function u(e,o){o.width=e}const n=e=>{d.selectedRowKeys=e};return(e,o)=>(_(),x(D,null,[l(t(M),{columns:s.value,"data-source":a.value,pagination:i.value,"row-selection":{selectedRowKeys:d.selectedRowKeys,onChange:n},onChange:h,onResizeColumn:u},{title:c(()=>[b("div",te,[b("div",ae,g(t(r)("dictionary.management")),1),l(t(z),{type:"primary",onClick:o[0]||(o[0]=v=>m.value.show())},{default:c(()=>[q(g(t(r)("dictionary.create")),1)]),_:1})])]),footer:c(()=>[l(t(z),{type:"primary",danger:"",onClick:o[1]||(o[1]=v=>p(d.selectedRowKeys)),disabled:d.selectedRowKeys.length===0},{default:c(()=>[l(t(U),{icon:"fa-solid fa-trash"})]),_:1},8,["disabled"])]),bodyCell:c(v=>[v.column.dataIndex==="action"?(_(),x("div",le,[l(t(U),{class:"action-icon",icon:"fa-solid fa-pen-to-square",style:{color:"darkgreen"},onClick:y=>m.value.show(v.record)},null,8,["onClick"]),l(t(U),{class:"action-icon",icon:"fa-solid fa-trash",style:{color:"red"},onClick:y=>p([v.record.dictionary_id])},null,8,["onClick"])])):$("",!0),v.column.dataIndex==="children"?(_(!0),x(D,{key:1},T(v.record.items,y=>(_(),x("p",null,g(y.translate?t(r)(y.text):y.text),1))),256)):$("",!0)]),_:1},8,["columns","data-source","pagination","row-selection"]),l(ee,{ref_key:"dialog",ref:m,"after-close":k},null,512)],64))}});export{we as default};
