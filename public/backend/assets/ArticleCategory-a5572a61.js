import{d as $,r as y,D as B,e as v,h as b,m as u,c as n,j as t,f as k,x as j,E,F as x,C as S,u as K,a as F,A as D,q as A,B as I,t as V}from"./index-21df96f3.js";import{S as N,M as O,i as q,T as L}from"./array-92a8b245.js";import{g as P,h as W,i as M,j as G}from"./article-fbe54c2e.js";import{a as H}from"./dictionary-1305017a.js";import{B as w,F as U,a as R,I as z}from"./index-dd0be179.js";import{S as J}from"./StopOutlined-011e502e.js";import{R as Q,C as T}from"./index-52e0a860.js";import{_ as X}from"./_plugin-vue_export-helper-c27b6911.js";import"./_getTag-cb3a9032.js";import"./index-384f7243.js";import"./zoom-fa2480fe.js";import"./createContext-7f56f6d1.js";import"./Col-744c166f.js";import"./TextArea-070ff12e.js";import"./collapseMotion-551979cf.js";import"./LeftOutlined-5519a846.js";import"./index-5e00876c.js";import"./index-a9aa29ea.js";import"./Compact-e6ea7b3c.js";import"./request-a2427700.js";import"./axios-05d0700c.js";import"./global-d6a70a19.js";const Y=$({__name:"DictionarySelector",props:{limit:{default:1,type:Number},value:{default:[],type:Array},ids:{default:[],type:Array}},emits:["update:value","update:ids"],setup(h,{emit:d}){const p=h,m=y([]),l=y([]),a=()=>{d("update:ids",l.value)};B(()=>{let c=[];Array.isArray(p.value)&&p.value.forEach(r=>{r&&r.hasOwnProperty("dictionary_id")&&c.push(r.dictionary_id)}),l.value=c}),H().then(c=>{c.data.forEach(r=>{r.key=r.dictionary_id,r.label=r.text,r.value=r.dictionary_id}),m.value=c.data});const s=c=>{l.value=l.value.filter((r,_)=>c!==_),a()};return(c,r)=>(v(),b(t(U).ItemRest,null,{default:u(()=>[n(t(Q),{style:{width:"100%",gap:"10px"}},{default:u(()=>[(v(!0),k(j,null,E(l.value,(_,g)=>(v(),b(t(T),{span:24,style:{display:"flex","align-items":"center","column-gap":"10px"}},{default:u(()=>[n(t(N),{options:m.value,value:l.value[g],"onUpdate:value":i=>l.value[g]=i,style:{flex:"1"},onChange:a},null,8,["options","value","onUpdate:value"]),n(t(w),{type:"primary",style:{display:"flex","justify-content":"center","align-items":"center"},danger:"",shape:"circle",size:"small",icon:c.h(t(J)),onClick:i=>s(g)},null,8,["icon","onClick"])]),_:2},1024))),256)),l.value.length<h.limit?(v(),b(t(T),{key:0,span:24},{default:u(()=>[n(t(w),{onClick:r[0]||(r[0]=_=>l.value.push(null)),style:{width:"100%"}},{default:u(()=>[n(t(x),{icon:"fa-solid fa-add"})]),_:1})]),_:1})):S("",!0)]),_:1})]),_:1}))}}),Z={__name:"ArticleCategoryForm",props:["afterClose"],setup(h,{expose:d}){const p=h,{t:m}=K(),l=y({}),a=y({}),s=y(!1);d({show:(i={})=>{var e;s.value=!0,a.value=i,(e=l.value)!=null&&e.clearValidate&&l.value.clearValidate()},close:()=>{s.value=!1}});const _=()=>{l.value.validate().then(()=>{Object.keys(a.value).forEach((i,e)=>{(a.value[i]===void 0||a.value[i]===null||a.value[i]==="")&&delete a.value[i]}),Object.hasOwn(a.value,"art_category_id")?W(a.value).then((i,e)=>{s.value=!1,p.afterClose&&p.afterClose()}):P(a.value).then((i,e)=>{s.value=!1,p.afterClose&&p.afterClose()})})},g=F(()=>{var i;return(i=a.value)!=null&&i.art_category_id?m("art_category.update"):m("art_category.create")});return(i,e)=>(v(),b(t(O),{open:s.value,"onUpdate:open":e[4]||(e[4]=o=>s.value=o),title:g.value,modal:"",style:{width:"80vw"},okText:t(m)("common.confirm"),cancelText:t(m)("common.cancel"),onOk:_,"mask-closable":!1,afterClose:null,keyboard:!1},{default:u(()=>[n(t(U),{model:a.value,layout:"vertical",ref_key:"form",ref:l},{default:u(()=>[n(t(R),{name:"art_category_id",hidden:!0},{default:u(()=>[n(t(z),{value:a.value.art_category_id,"onUpdate:value":e[0]||(e[0]=o=>a.value.art_category_id=o)},null,8,["value"])]),_:1}),n(t(R),{name:"label",label:t(m)("art_category.name"),rules:[{required:!0,message:t(m)("art_category.name_required")}]},{default:u(()=>[n(t(z),{value:a.value.label,"onUpdate:value":e[1]||(e[1]=o=>a.value.label=o)},null,8,["value"])]),_:1},8,["label","rules"]),n(t(R),{name:"dictionaries",label:t(m)("art_category.dictionary")},{default:u(()=>[n(Y,{value:a.value.dictionaries,"onUpdate:value":e[2]||(e[2]=o=>a.value.dictionaries=o),ids:a.value.dict_ids,"onUpdate:ids":e[3]||(e[3]=o=>a.value.dict_ids=o),limit:10},null,8,["value","ids"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["open","title","okText","cancelText"]))}};const ee={style:{display:"flex"}},te={style:{"flex-grow":"1",display:"flex","align-items":"center"}},ae={style:{"font-size":"20px","font-weight":"bold"}},le={key:0},oe={key:1},ne={__name:"ArticleCategory",setup(h){const{t:d}=K(),p=y(),m=y([{title:d("art_category.name"),dataIndex:"label",ellipsis:!0,resizable:!0,width:300,minWidth:150},{title:d("art_category.article_count"),dataIndex:"article_count",ellipsis:!0,resizable:!0,width:300,minWidth:150},{title:d("common.action"),dataIndex:"action",ellipsis:!0,resizable:!0,width:100,minWidth:100}]),l=y({hideOnSinglePage:!0,current:1,total:1,pageSize:10,position:["bottomCenter"]}),a=y([]),s=D({selectedRowKeys:[],loading:!1}),c=()=>{M({page:l.value.current,limit:l.value.pageSize}).then(e=>{var o;if(l.value.total=e.data.total,l.value.current=e.data.current_page,Array.isArray((o=e==null?void 0:e.data)==null?void 0:o.data)){let f=[];e.data.data.forEach(C=>{C.key=C.art_category_id,f.push(C.key)}),s.selectedRowKeys=q(s.selectedRowKeys,f),a.value=e.data.data}})};c();const r=e=>{l.value.current=e.current,l.value.pageSize=e.pageSize,c()},_=e=>{O.confirm({title:d("common.delete_confirm"),content:d("art_category.delete_branch_confirmation",{count:e.length}),okText:d("common.confirm"),cancelText:d("common.cancel"),onOk(){G({ids:e}).then(()=>{c()})}})};function g(e,o){o.width=e}const i=e=>{s.selectedRowKeys=e};return(e,o)=>(v(),k(j,null,[n(t(L),{columns:m.value,"data-source":a.value,pagination:l.value,"row-selection":{selectedRowKeys:s.selectedRowKeys,onChange:i},onChange:r,onResizeColumn:g},{title:u(()=>[A("div",ee,[A("div",te,[A("div",ae,I(t(d)("art_category.management")),1)]),n(t(w),{type:"primary",onClick:o[0]||(o[0]=f=>p.value.show())},{default:u(()=>[V(I(t(d)("art_category.create")),1)]),_:1})])]),footer:u(()=>[n(t(w),{type:"primary",danger:"",onClick:o[1]||(o[1]=f=>_(s.selectedRowKeys)),disabled:s.selectedRowKeys.length===0},{default:u(()=>[n(t(x),{icon:"fa-solid fa-trash"})]),_:1},8,["disabled"])]),bodyCell:u(f=>[f.column.dataIndex==="article_count"?(v(),k("span",le,I(f.record.articles_count),1)):S("",!0),f.column.dataIndex==="action"?(v(),k("div",oe,[n(t(x),{class:"action-icon",icon:"fa-solid fa-pen-to-square",style:{color:"darkgreen"},onClick:C=>p.value.show(f.record)},null,8,["onClick"]),n(t(x),{class:"action-icon",icon:"fa-solid fa-trash",style:{color:"red"},onClick:C=>_([f.record.art_category_id])},null,8,["onClick"])])):S("",!0)]),_:1},8,["columns","data-source","pagination","row-selection"]),n(Z,{ref_key:"dialog",ref:p,"after-close":c},null,512)],64))}},Se=X(ne,[["__scopeId","data-v-3db962be"]]);export{Se as default};
