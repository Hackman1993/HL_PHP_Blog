import{w as _,d as M,N as x,r as S,O as E,o as U,b as L,P as z,Q as F,k as w,I as R,e as T,h as K,j as A,R as N}from"./index-b3aac28e.js";import{r as D}from"./request-737d36eb.js";import{F as G}from"./index-59a216ae.js";var H=["onActivate","onAddUndo","onBeforeAddUndo","onBeforeExecCommand","onBeforeGetContent","onBeforeRenderUI","onBeforeSetContent","onBeforePaste","onBlur","onChange","onClearUndos","onClick","onContextMenu","onCopy","onCut","onDblclick","onDeactivate","onDirty","onDrag","onDragDrop","onDragEnd","onDragGesture","onDragOver","onDrop","onExecCommand","onFocus","onFocusIn","onFocusOut","onGetContent","onHide","onInit","onKeyDown","onKeyPress","onKeyUp","onLoadContent","onMouseDown","onMouseEnter","onMouseLeave","onMouseMove","onMouseOut","onMouseOver","onMouseUp","onNodeChange","onObjectResizeStart","onObjectResized","onObjectSelected","onPaste","onPostProcess","onPostRender","onPreProcess","onProgressState","onRedo","onRemove","onReset","onSaveContent","onSelectionChange","onSetAttrib","onSetContent","onShow","onSubmit","onUndo","onVisualAid"],q=function(n){return H.map(function(t){return t.toLowerCase()}).indexOf(n.toLowerCase())!==-1},Q=function(n,t,e){Object.keys(t).filter(q).forEach(function(a){var r=t[a];typeof r=="function"&&(a==="onInit"?r(n,e):e.on(a.substring(2),function(u){return r(u,e)}))})},W=function(n,t,e,a){var r=n.modelEvents?n.modelEvents:null,u=Array.isArray(r)?r.join(" "):r;_(a,function(l,i){e&&typeof l=="string"&&l!==i&&l!==e.getContent({format:n.outputFormat})&&e.setContent(l)}),e.on(u||"change input undo redo",function(){t.emit("update:modelValue",e.getContent({format:n.outputFormat}))})},J=function(n,t,e,a,r,u){a.setContent(u()),e.attrs["onUpdate:modelValue"]&&W(t,e,a,r),Q(n,e.attrs,a)},I=0,P=function(n){var t=Date.now(),e=Math.floor(Math.random()*1e9);return I++,n+"_"+e+I+String(t)},X=function(n){return n!==null&&n.tagName.toLowerCase()==="textarea"},j=function(n){return typeof n>"u"||n===""?[]:Array.isArray(n)?n:n.split(" ")},Y=function(n,t){return j(n).concat(j(t))},Z=function(n){return n==null},k=function(){return{listeners:[],scriptId:P("tiny-script"),scriptLoaded:!1}},$=function(){var n=k(),t=function(r,u,l,i){var o=u.createElement("script");o.referrerPolicy="origin",o.type="application/javascript",o.id=r,o.src=l;var m=function(){o.removeEventListener("load",m),i()};o.addEventListener("load",m),u.head&&u.head.appendChild(o)},e=function(r,u,l){n.scriptLoaded?l():(n.listeners.push(l),r.getElementById(n.scriptId)||t(n.scriptId,r,u,function(){n.listeners.forEach(function(i){return i()}),n.scriptLoaded=!0}))},a=function(){n=k()};return{load:e,reinitialize:a}},nn=$(),en=function(){return typeof window<"u"?window:global},y=function(){var n=en();return n&&n.tinymce?n.tinymce:null},tn={apiKey:String,cloudChannel:String,id:String,init:Object,initialValue:String,inline:Boolean,modelEvents:[String,Array],plugins:[String,Array],tagName:String,toolbar:[String,Array],modelValue:String,disabled:Boolean,tinymceScriptSrc:String,outputFormat:{type:String,validator:function(n){return n==="html"||n==="text"}}},p=globalThis&&globalThis.__assign||function(){return p=Object.assign||function(n){for(var t,e=1,a=arguments.length;e<a;e++){t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},p.apply(this,arguments)},an=function(n,t,e,a){return n(a||"div",{id:t,ref:e})},on=function(n,t,e){return n("textarea",{id:t,visibility:"hidden",ref:e})},rn=M({props:tn,setup:function(n,t){var e=n.init?p({},n.init):{},a=x(n),r=a.disabled,u=a.modelValue,l=a.tagName,i=S(null),o=null,m=n.id||P("tiny-vue"),g=n.init&&n.init.inline||n.inline,f=!!t.attrs["onUpdate:modelValue"],d=!0,v=n.initialValue?n.initialValue:"",h="",V=function(c){return f?function(){return u!=null&&u.value?u.value:""}:function(){return c?v:h}},C=function(){var c=V(d),s=p(p({},e),{readonly:n.disabled,target:i.value,plugins:Y(e.plugins,n.plugins),toolbar:n.toolbar||e.toolbar,inline:g,setup:function(b){o=b,b.on("init",function(B){return J(B,n,t,b,u,c)}),typeof e.setup=="function"&&e.setup(b)}});X(i.value)&&(i.value.style.visibility=""),y().init(s),d=!1};_(r,function(c){var s;o!==null&&(typeof((s=o.mode)===null||s===void 0?void 0:s.set)=="function"?o.mode.set(c?"readonly":"design"):o.setMode(c?"readonly":"design"))}),_(l,function(c){var s;f||(h=o.getContent()),(s=y())===null||s===void 0||s.remove(o),E(function(){return C()})}),U(function(){if(y()!==null)C();else if(i.value&&i.value.ownerDocument){var c=n.cloudChannel?n.cloudChannel:"6",s=n.apiKey?n.apiKey:"no-api-key",b=Z(n.tinymceScriptSrc)?"https://cdn.tiny.cloud/1/".concat(s,"/tinymce/").concat(c,"/tinymce.min.js"):n.tinymceScriptSrc;nn.load(i.value.ownerDocument,b,C)}}),L(function(){y()!==null&&y().remove(o)}),g||(z(function(){d||C()}),F(function(){var c;f||(h=o.getContent()),(c=y())===null||c===void 0||c.remove(o)}));var O=function(c){var s;h=o.getContent(),(s=y())===null||s===void 0||s.remove(o),e=p(p({},e),c),E(function(){return C()})};return t.expose({rerender:O,getEditor:function(){return o}}),function(){return g?an(w,m,i,n.tagName):on(w,m,i)}}});const un=n=>D("/attachment/upload","post",n),dn=n=>D(`/attachment/info/${n.attachment_id}`,"get",n),fn={__name:"TinymceEditor",props:["value","abstract","attachments"],emits:["update:value","update:abstract","update:attachments","change"],setup(n,{expose:t,emit:e}){const a=n,r=G.useInjectFormItemContext();let u=S(),l=S([]),i=S(a.value);t({value:i,editor_attachments:l});const o=(g,f)=>new Promise((d,v)=>{un({file:g.blob()}).then(h=>{l.value.push(h.data.attachment_id),e("update:attachments",l.value),d(h.data.access_url)})});R(()=>{i.value=a.value?a.value:""});const m=(g,f)=>{let d=f.getContent(),v=f.getContent({format:"text"});v=v.replaceAll(`
`,""),v=v.substring(0,200),e("update:value",d),e("update:abstract",v),e("change",d),r.onFieldChange()};return(g,f)=>(T(),K(A(rn),{ref_key:"editor",ref:u,modelValue:A(i),"onUpdate:modelValue":f[0]||(f[0]=d=>N(i)?i.value=d:i=d),"api-key":"bkfzcveiis7xhbstaqc76avuy8rps8zq2iff70838ko49514","model-events":"change keydown blur focus paste",onChange:m,init:{language:"zh-Hans",language_url:"/i18n/zh-Hans.js",menubar:!1,plugins:"advlist autolink lists link image charmap preview anchor searchreplace visualblocks code fullscreen insertdatetime media table code wordcount media link",toolbar:"formatselect | bold italic backcolor styles | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | removeformat | image media | link",automatic_uploads:!0,images_upload_handler:o}},null,8,["modelValue","init"]))}};export{dn as A,fn as _,un as a};
